name: Python Unit Tests

on:
  push:
    branches: [ "main", "dev" ] # Run tests on push to main or development branches
  pull_request:
    branches: [ "main" ] # Run tests when a Pull Request is opened against main
  workflow_dispatch: # Allows manual triggering of the workflow from the GitHub UI

jobs:
  run_tests:
    runs-on: ubuntu-latest # Standard environment for running Python tests

    steps:
    - name: ‚¨áÔ∏è Checkout code
      # Downloads a copy of your repository code
      uses: actions/checkout@v4

    - name: üõ†Ô∏è Set up Python Environment
      # Sets up the Python version required for your project
      uses: actions/setup-python@v5
      with:
        python-version: '3.11' # IMPORTANT: Change this if your project uses a different version

    - name: üì¶ Install dependencies
      # Install any external libraries your code relies on (e.g., pandas, requests)
      run: |
        python -m pip install --upgrade pip
        # Install dependencies from your requirements file
        if [ -f requirements.txt ]; then
          pip install -r requirements.txt
        fi

    - name: üèÉ Run Unit Tests
      # Execute the tests using the built-in 'unittest' discovery module
      # This command discovers all files named 'test_*.py' inside the 'tests' directory
      # We use 'python -m unittest' which is the standard way to run unittest discovery
      run: |
        # Set the Python path to include the 'src' directory so imports work correctly
        export PYTHONPATH=$PYTHONPATH:$(pwd)/src
        
        # Run the tests with verbose output
        python -m unittest discover -s tests -p 'test_*.py'
      env:
        # Define any environment variables needed for your tests (e.g., API keys, although here we mock them)
        PYTHONUNBUFFERED: 1

    - name: üéâ Success
      if: success()
      run: echo "All unit tests passed!"

    - name: ‚ùå Failure
      if: failure()
      run: echo "Unit tests failed. Check the logs for details."